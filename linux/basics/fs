I- Concepts                        
#
VFS           : virtual file system interface provides a common interface for different file system types.
Inode         : index node containi metadata for a file system object(permissions,timestamps, data pointers).
Extent        : an extent is a contiguous group of blocks.
Journaling    : writes journal logs in journal area before writing actual user data to the file system.
Copy-on-Write : file system does not overwrite existing blocks.
Scrubbing     : asynchronously reads all data blocks and verifies checksums
WriteBarriers : enforce proper on-disk ordering of journal commits, disk controller caches safe to use
Read-ahead    : pre-fetching data that is likely to be read and loading it into the page cache.

II- FS  Tuning 
#
1) VFS
# Documenation available in /usr/share/doc/kernel-doc-<version>/Documenation/sysctl/fs.txt and vm.txt
fs.file-max   (/proc/sys/fs/file-max)   = maximum number of file-handles the kernel will allocate.
fs.nr_open    (/proc/sys/fs/nr_open)    = maximum number of file-handles a process can allocate.
fs.aio-max-nr (/proc/sys/fs/aio-max-nr) = maximum number of asynchronous io requests system-wide.

vm.drop_caches (/proc/sys/vm/drop_caches) = 1 : free pagecache
                                          = 2 : free dentries and inodes
                                          = 3 : free pagecache, dentries and inodes

vm.vfs_cache_pressure (/proc/sys/vm/cache_pressure) = controls kernel directory and inode objects caching tendency.
                                                    = 100  : fair rate cache/reclaim
                                                    = <100 : perfer cache
                                                    = 0    : always cache
                                                    = >100 : perfer reclaim
2) XFS  
# Documenation available in /usr/share/doc/kernel-doc-<version>/Documenation/filesystems/xfs.txt
fs.xfs.xfssyncd_centisecs   (Min: 100 Default:3000 Max:720000) interval at which the xfssyncd thread flushes metadataout to disk.
fs.xfs.xfsbufd_centisecs    (Min: 50  Default:100  Max:3000)   interval at which xfsbufd scans the dirty metadata buffers list.
fs.xfs.age_buffer_centisecs (Min: 100 Default:1500 Max:720000) age at which xfsbufd flushes dirty metadata buffers to disk.

III- Format and Mount Options
# 
/proc/filesystems : all filesystems registered to the kernel ( nodev : without persistent storage device)
/proc/mounts      : list of all currently mounted filesystem (/proc/mtab).
/proc/fstab       : list of all mounts entries.
#
df      -aTh      : list all filesystems with type and usage Bytes (-i for inode usage).    
findmnt -a        : tree list all mounted filesytems or search for a filesystem.
lsblk   -af       : list all block devices and corresponding mount points.
#
1) Ext4
# Documenation available in /usr/share/doc/kernel-doc-<version>/Documenation/filesystems/ext4.txt
/sys/fs/ext4/<disk>

# Configurations in /etc/mke2fs.conf
mk2fs : -n = dry-run formatting paratition
        -N = specify inode size (Default 256)
        -b = block size : 1024,2048 or 4096
        -i = inode for every bytes-per-inode bytes 
        -I = inode size in bytes (Default 256)
        -E : stride       =stride-size RAID chunk-size / Block Size
             stripe_width =stripe-width (Number of disks * stride)
             discard :  discard blocks at mkfs (disbale nodiscard) 
        -J : size   = internel journal size in MB
             device = device of external journal (also label or uuid)
        -O : journal_dev <external-journal> : create externel journal. 
             <feature>                      : override filesystem default features (/etc/mke2fs.conf)
        -T : usage type (small,big ....)
tune2fs : can be used to adjust most of these parameters (may need to be unmounted)

Note: Number of disks in RAID is calculated : RAID 0  --> N
                                              RAID 1  --> N/2
                                              RAID 5  --> N-1
                                              RAID 10 --> N/2
      Stride size = [RAID chunk size] / [Filesystem block size]
2) XFS
# Documenation available in /usr/share/doc/kernel-doc-<version>/Documenation/filesystems/xfs.txt
/sys/fs/xfs/<disk>
mkfs.xfs : -b : size=<bytes> filesystem block size (min 512,default 4kB,max 64KB )
           -d : agcount= number of allocation groups (number of CPUs)
                agsize=<bytes> size of allocation group ( min 16 MB, max 1 TB)
                sunit  = stripe unit (chunk-size/block size) of RAID array in 512-byte block / su in bytes
                swidth = stripe width of RAID array in 512-byte block (number of disks in raid * 512 )/ sw = number of disks in raid
           -i :
           -l : internal = 1 internel log device,0 external log device
                logdev   = device for filesystem log
                size     = size of log in bytes(*b in blocks)
                sunit/su = same as for data
           -n : size= directory block size in bytes (for many small files : 64KB for >1,000,000 entries)
           



Mount Options :

Defaults mount options are : rw, suid, dev, exec, auto, nouser, and async

Note: Filesystems has specific mount options. Example: for extended filesystem family defaults mount options can be listed by : tune2fs -l <paratition>

noatime
This feature disables registering a file access time.

data=writeback
This feature allows metadata to be written asynchronously from the corresponding data.

barrier=0

IV- Comparison of FS
 
                        EXT4             XFS        BTRFS

Indexing Algorithm      Hash B-tree      B+tree     Modified B-tree
Max volume size         1 Ebytes         8 Ebytes   16 Ebytes
Max file size           16 Tbytes        8 Ebytes   16 Ebytes
Max number of files     4 billion        2^64       2^64
Max file name size      255 bytes        255 bytes  255 bytes
Transparent compression No               No         Yes
Transparent encryption  Yes              No         Planned
Copy-on-Write (COW)     No               Planned    Yes
Snapshots               No               Planned    Yes

